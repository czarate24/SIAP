/*
 * File: app/view/windowAjustesController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('cartera.view.windowAjustesController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.windowajustes',

    onbtnGuardar1: function(button, e, eOpts) {
        var record1, record2, store;
        var data_jsonAr = [];
        var ctrl = this,
            storeGenerar = Ext.getStore("GenerarStore"),
            record;
        // rec;
        record = storeGenerar;
        // console.log(record.data.items);
        // var existe= Ext.getCmp("exis").checked;
        //var todos= Ext.getCmp("todos").checked;
        //var fisico = Ext.getCmp('fisico').getValue();
        //var p = Ext.getCmp('proBar', {
        //  renderTo: Ext.getBody(),
        // width: 300
        //});






        Ext.Ajax.request({
            clientValidation: true,
            url: 'api/ajustes/generarajustes',
            method: "POST",
            params: {
                nombre: Ext._nombre,

            },


            success: function(response) {
                Ext.Msg.show({
                    title: 'Mensaje del Sistema',
                    msg: "Se han Aplicado los Ajustes con Ã©xito",
                    buttons: Ext.Msg.OK,
                    icon: Ext.Msg.INFO,
                    closable: false,
                    callback:function(){
                        //  button.up('window').close();
                        // alert();
                    }


                });
                new Ext.Window({
                    title : "ENTRADAS POR AJUSTES DE AUDITORIA (FALTANTES SOBRE KARDEX) ",
                    width : 990,
                    maximizable: true,
                    modal: true,
                    height: 700,
                    layout : 'fit',
                    items : [{
                        xtype : "component",
                        autoEl : {
                            tag : "iframe",
                            src : 'pdf/pdf_EntradaAjustes.php'
                            //?direccion='+direccion+'&idcolumna='+idcolumna+'&nivel='+nivel+
                            //'&origenbeca='+origenbeca+'&tiposolicitud='+tiposolicitud+'&tipobeca='+tipobeca+'&estatus='+estatus+
                            //'&grado='+grado
                        }
                    }]
                }).show();
                new Ext.Window({
                    title : "SALIDAS POR AJUSTES DE AUDITORIA (SOBRANTES SOBRE KARDEX) ",
                    width : 990,
                    maximizable: true,
                    modal: true,
                    height: 700,
                    layout : 'fit',
                    items : [{
                        xtype : "component",
                        autoEl : {
                            tag : "iframe",
                            src : 'pdf/pdf_SalidaAjustes.php'
                            //?direccion='+direccion+'&idcolumna='+idcolumna+'&nivel='+nivel+
                            //'&origenbeca='+origenbeca+'&tiposolicitud='+tiposolicitud+'&tipobeca='+tipobeca+'&estatus='+estatus+
                            //'&grado='+grado
                        }
                    }]
                }).show();
                button.up('window').close();
                Ext.getCmp('tabAjuste').close();

            },
            failure: function(response) {
                Ext.Msg.show({
                    title: 'Error',
                    msg: "No se pudieron aplicar los ajustes",
                    buttons: Ext.Msg.OK,
                    icon: Ext.Msg.ERROR
                });
            }
        });





    },

    onbtnCancelar1: function(button, e, eOpts) {
        button.up('window').close();
    },

    onWindowAfterRender: function(component, eOpts) {

        var sobrante_exi = 0;
        var sobrante_cto = 0;
        var faltante_exi = 0;
        var faltante_cto = 0;
        //storeSobranteSum = Ext.getStore("SobrantesSumStore");
        Ext.getStore('SumStore').load();
        var storeSob =   Ext.getStore("SumStore");


        storeSob.on('load', function() {
            sobrante_exi = storeSob.getAt(0).get('sobrante_exi_sum');
            sobrante_cto = storeSob.getAt(0).get('sobrante_cto_sum');
            faltante_exi = storeSob.getAt(0).get('faltante_exi_sum');
            faltante_cto = storeSob.getAt(0).get('faltante_cto_sum');

            //Ext.Msg.alert('Simpson', 'Name: ' + faltante_exi);
            Ext.getCmp('SobranteCant').setValue(sobrante_exi);
            Ext.getCmp('SobranteCto').setValue(sobrante_cto);
            Ext.getCmp('FaltanteCant').setValue(faltante_exi);
            Ext.getCmp('FaltanteCto').setValue(faltante_cto);

            Ext.getCmp('NetoCant').setValue(sobrante_exi-faltante_exi);
            Ext.getCmp('NetoCto').setValue(sobrante_cto-faltante_cto);
        });


    }

});
